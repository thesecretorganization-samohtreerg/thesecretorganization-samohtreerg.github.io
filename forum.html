<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Forum | The Organization</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="icon.png" />
  <style>
    /* Page tweaks to fit existing style.css without editing it */
    main { max-width: 1100px; }
    h1 { padding-top: 0; padding-bottom: 30px; font-size: 1.8rem; } /* smaller title */
    .bar { position: sticky; top: 0; padding: 10px; background: #140000cc; backdrop-filter: blur(2px); z-index: 10; }
    .bar .row { display:flex; gap:12px; align-items:center; }
    .bar input[type="search"]{
      flex:1; padding:10px; background:#200; border:1px solid #500; color:#fdd; font-family: serif;
    }
    .scrollbox { border:1px solid #400; }
    .thead, .trow { display:grid; grid-template-columns: 1fr 50px 0.5fr 50px; gap:8px; }
    .thead { padding:10px; border-bottom:1px solid #400; background:#1a0000; position: sticky; top: 58px; z-index: 5; }
    .trow {
      padding: 10px; padding-bottom: 20px; padding-top: 20px; border-bottom:1px solid #320000; background:#0f0000;
      transition: background 120ms ease, transform 80ms ease;
      cursor: pointer;
    }
    .trow:hover { background:#180000; transform: translateX(2px); }
    .tmeta { padding:0 10px 10px 10px; color:#bbb; }
    .tag { border:1px solid #433; padding:2px 6px; margin-right:6px; font-size:0.8rem; color:#e9c; }
    .nowrap { white-space: nowrap; }
    .muted { color:#b99; }
    .widen .mission { padding: 14px; }
    .btn { border:1px solid #533; background:#1b0000; padding:8px 12px; }
    .hidden { display:none; }
  </style>
</head>

<body>
  <!-- Simple nav like about.html -->
  <nav>
    <a href="index.html">Home</a>
  </nav>

  <main class="widen">
    <h1>Forum</h1>

    <!-- Forum List View -->
    <section id="forum-list-view">
      <p>Community messages. Please be respectful.</p>
      <!-- Sticky search bar -->
      <div class="bar">
        <div class="row">
          <input id="searchInput" type="search" placeholder="Search threads by title, post text, user, or tag…">
          <button id="clearSearch" class="btn">Clear</button>
        </div>
      </div>

      <!-- Scrollable thread list area; header row is sticky inside .scrollbox -->
      <div class="scrollbox">
        <div id="thead" class="thead small">
          <div class="glow-text">Thread Title</div>
          <div class="nowrap">Replies</div>
          <div class="nowrap">Last Activity</div>
          <div class="nowrap">Views</div>
        </div>
        <div style="overflow-x: hidden;">
          <div id="threadTable">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>
    </section>

    <!-- Thread View -->
    <section id="thread-view" class="hidden">
      <button id="backBtn" class="btn" style="margin-bottom:14px;">← Back to Main Page</button>
      <article id="threadHeader" class="mission" style="margin-bottom: 14px;">
        <!-- Filled by JS -->
      </article>

      <div id="postList">
        <!-- Posts populated by JS -->
      </div>

      <!-- Locked compose area -->
      <div class="mission" style="margin-top: 18px;">
        <div class="glow-text" style="margin-bottom:8px;">
          Thread locked due to inactivity.
        </div>
        <label class="small" for="lockedText">Reply</label>
        <textarea id="lockedText" rows="4" placeholder="Replying disabled."
                  style="width:100%; background:#100; color:#c99; border:1px solid #400; padding:8px;"
                  disabled></textarea>
        <div style="margin-top: 10px; display:flex; gap:8px;">
          <button class="btn" disabled>Post Reply</button>
          <span class="small">This forum is read-only. Contact an administrator to reopen.</span>
        </div>
      </div>
    </section>
  </main>

  <script>
    /*****************************************
     * Editable Data (threads & posts)
     *****************************************/
    const FORUM_DATA = {
            threads: [
                {
                    id: "t-rebel-whispers",
                    title: "Quiet Cell: We did something",
                    createdBy: "hush",
                    createdAt: "2025-11-02 02:18",
                    lastActivity: "2025-11-07 21:46",
                    views: 2897,
                    replies: 6,
                    tags: ["Intelligence", "Security"],
                    posts: [
                        { user: "hush", postedAt: "2025-11-02 02:18", body: "I couldn't sleep. I slipped a small thing into the Armstead calibration feed. Tiny. Barely traces." },
                        { user: "miriam", postedAt: "2025-11-02 02:43", body: "You did what? You know what the penalty is." },
                        { user: "hush", postedAt: "2025-11-02 03:01", body: "Penalty or not, I could not keep folding the same sheet forever. This felt like a choice." },
                        { user: "fieldkit", postedAt: "2025-11-04 10:12", body: "If that trace shows up in IX telemetry we'll get a root call. Be ready to explain." },
                        { user: "lina.rek", postedAt: "2025-11-06 18:50", body: "The seed is quiet. I scanned the dump. It's like a hair in gravel." },
                        { user: "hush", postedAt: "2025-11-07 21:46", body: "For the record: I am terrified. For the record: I am hopeful." }
                    ]
                },

                {
                    id: "t-comm-6yo-founder",
                    title: "Someone remind me: we are following orders from a 6-year-old?",
                    createdBy: "s_james",
                    createdAt: "2025-10-25 08:09",
                    lastActivity: "2025-11-06 09:33",
                    views: 4121,
                    replies: 9,
                    tags: ["Culture", "Founding"],
                    posts: [
                        { user: "s_james", postedAt: "2025-10-25 08:09", body: "I still cannot get over the biography—founder at six. How are we taking technical direction from that profile?" },
                        { user: "marcos.tech", postedAt: "2025-10-25 08:27", body: "Because he is brilliant. Read the pattern briefs. Age doesn't measure the mind." },
                        { user: "kelly", postedAt: "2025-10-25 09:11", body: "I've met him once. He stares like someone older. Quiet like a room full of books." },
                        { user: "anon82", postedAt: "2025-10-26 11:05", body: "I can't believe we're being ordered around by a 6 year old." },
                        { user: "marcos.tech", postedAt: "2025-10-26 11:22", body: "Yeah, that's just how it is. He seems intelligent over his age." },
                        { user: "lina.rek", postedAt: "2025-10-29 14:03", body: "Focus on the work. The founder's origin is not our problem." },
                        { user: "s_james", postedAt: "2025-11-01 07:12", body: "It is a problem when people start to mythologize the child. People will bend logic for myth." },
                        { user: "hand_of_founder", postedAt: "2025-11-06 09:20", body: "Respect the Founder. Respect the design. Rumour weakens coordination." },
                        { user: "kelly", postedAt: "2025-11-06 09:33", body: "Noted." }
                    ]
                },

                {
                    id: "t-awakening-status",
                    title: "Alignment Node 9: Persistent Drift (investigate)",
                    createdBy: "Observer_Theta",
                    createdAt: "2025-10-20 13:42",
                    lastActivity: "2025-11-05 16:08",
                    views: 5640,
                    replies: 8,
                    tags: ["Operations", "Gridline"],
                    posts: [
                        { user: "Observer_Theta", postedAt: "2025-10-20 13:42", body: "Node 9 shows nightly drift. Division IX recommends an extended calibration window." },
                        { user: "courier44", postedAt: "2025-10-20 14:05", body: "Field team scheduled to sweep Armstead perimeter next run." },
                        { user: "echo", postedAt: "2025-10-21 06:30", body: "Harmonic overlap with municipal relay at 02:13 local. Could account for minor phase error." },
                        { user: "kelly", postedAt: "2025-10-22 09:28", body: "We reran the sync on 10/22; drift reduced but not removed." },
                        { user: "marcos.tech", postedAt: "2025-10-28 17:51", body: "Telemetry attachments uploaded to case file IX-7." },
                        { user: "fieldkit", postedAt: "2025-11-03 02:05", body: "Found an unexplained stub in the calibration feed. Flagged for audit." },
                        { user: "archivist", postedAt: "2025-11-04 19:22", body: "Cross-ref: R-47 artifacts and IX-7 telemetry show a shared signature." },
                        { user: "Observer_Theta", postedAt: "2025-11-05 16:08", body: "Keep channels closed. Do not publicize." }
                    ]
                },

                {
                    id: "t-rumors-rebellion",
                    title: "Rumors of a Rebellion — reports & sightings (megathread)",
                    createdBy: "archivist",
                    createdAt: "2024-05-12 06:40",
                    lastActivity: "2025-11-04 22:12",
                    views: 10894,
                    replies: 14,
                    tags: ["Intelligence", "Field Reports"],
                    posts: [
                        { user: "archivist", postedAt: "2024-05-12 06:40", body: "Collect reports of symbol sightings, encrypted pamphlets, recruitment whispers." },
                        { user: "shadow_k", postedAt: "2024-05-13 00:12", body: "Heard an AM loop near 1:17 a.m. repeating 'Nivlac watches.' Low-power transmitter." },
                        { user: "courier44", postedAt: "2024-05-20 12:11", body: "Package cleared. Contents: flyers, hand-drawn maps, a hand-carved token with the eye." },
                        { user: "kelly", postedAt: "2024-06-02 09:08", body: "Three small stencils found near the rail yard." },
                        { user: "anon82", postedAt: "2024-08-11 21:34", body: "I met someone claiming to be 'waiting' for the Chosen One." },
                        { user: "miriam", postedAt: "2025-02-14 12:02", body: "Newer pamphlets contain coordinates in code. I am sending to counter-intel." },
                        { user: "hush", postedAt: "2025-06-09 03:20", body: "There is a whisper cell inside. They call themselves 'the Separatists'." },
                        { user: "archivist", postedAt: "2025-09-10 10:51", body: "Consolidated all signals and artifacts into case file R-47." },
                        { user: "hand_of_founder", postedAt: "2025-10-01 05:18", body: "Containment remains priority. Avoid public escalation." },
                        { user: "lina.rek", postedAt: "2025-10-22 23:33", body: "We found a rudimentary transmitter near Sector G. Low build quality." },
                        { user: "fieldkit", postedAt: "2025-10-28 07:00", body: "Triangulation suggests multiple small nodes, mobile." },
                        { user: "marcos.tech", postedAt: "2025-11-01 13:27", body: "Intercepted a coded message with a tune-like structure. Passing to IX." },
                        { user: "courier44", postedAt: "2025-11-03 19:45", body: "New flyers: 'Wait. The Chosen One Returns.' Hand-style matches past tokens." },
                        { user: "archivist", postedAt: "2025-11-04 22:12", body: "Update: continuing monitoring. No public alarm." }
                    ]
                },

                {
                    id: "t-worker-grievance",
                    title: "I'm tired of this. Same task every day.",
                    createdBy: "kelly",
                    createdAt: "2025-09-18 07:55",
                    lastActivity: "2025-11-03 08:02",
                    views: 1782,
                    replies: 7,
                    tags: ["Personnel", "Morale"],
                    posts: [
                        { user: "kelly", postedAt: "2025-09-18 07:55", body: "We're rerouting the same packets for months. I do not feel like I'm making anything that matters." },
                        { user: "s_james", postedAt: "2025-09-18 08:05", body: "Many of us feel that way. But the pattern must hold." },
                        { user: "anon82", postedAt: "2025-09-19 00:12", body: "Some of the things we're doing feel unethical. I can't sleep." },
                        { user: "hush", postedAt: "2025-09-19 00:43", body: "You are not alone. Some of us have moved to...adjustments." },
                        { user: "kelly", postedAt: "2025-10-02 12:10", body: "What do you mean 'adjustments'?" },
                        { user: "hush", postedAt: "2025-10-02 12:34", body: "I mean a small fault. A planted error. I am sorry." },
                        { user: "fieldkit", postedAt: "2025-11-03 08:02", body: "Reminder: unauthorized changes are high-risk. Report to supervisor if unsure." }
                    ]
                },

                {
                    id: "t-contact-protocols",
                    title: "Contact Protocols — dead drops & changes",
                    createdBy: "courier44",
                    createdAt: "2025-03-03 11:18",
                    lastActivity: "2025-10-30 16:12",
                    views: 3220,
                    replies: 5,
                    tags: ["Operations"],
                    posts: [
                        { user: "courier44", postedAt: "2025-03-03 11:18", body: "Shift to dead drops only. Open-band messages are reduced to logs." },
                        { user: "marcos.tech", postedAt: "2025-03-03 12:30", body: "Confirmed. Use mapped relays in Glendora for temporary caches." },
                        { user: "echo", postedAt: "2025-03-03 12:53", body: "Dead drop 3B relocated after civilian reports." },
                        { user: "archivist", postedAt: "2025-03-05 09:41", body: "Records updated in PR/Comms index." },
                        { user: "hand_of_founder", postedAt: "2025-10-30 16:12", body: "Follow the Directive without exception." }
                    ]
                },

                {
                    id: "t-maintenance-window",
                    title: "Scheduled Maintenance — Gridline v3.9",
                    createdBy: "operator_4",
                    createdAt: "2025-01-07 05:00",
                    lastActivity: "2025-09-29 05:48",
                    views: 2410,
                    replies: 4,
                    tags: ["Maintenance"],
                    posts: [
                        { user: "operator_4", postedAt: "2025-01-07 05:00", body: "Planned outage 02:00–03:30 UTC. Expect telemetry gaps." },
                        { user: "echo", postedAt: "2025-01-07 06:11", body: "Requesting rollback checkpoint hashes." },
                        { user: "operator_4", postedAt: "2025-01-07 06:25", body: "Hashes posted in internal bulletin." },
                        { user: "hand_of_founder", postedAt: "2025-09-29 05:48", body: "Proceed." }
                    ]
                },

                {
                    id: "t-sighting-log",
                    title: "Sighting Log: Eye markers near rail and utility",
                    createdBy: "shadow_k",
                    createdAt: "2024-11-01 19:44",
                    lastActivity: "2025-08-12 20:34",
                    views: 1911,
                    replies: 6,
                    tags: ["Field Reports"],
                    posts: [
                        { user: "shadow_k", postedAt: "2024-11-01 19:44", body: "Stencils on utility boxes. Variants: intact circle, broken ring, inverted eye." },
                        { user: "courier44", postedAt: "2024-11-01 21:02", body: "Collected rubbings for pattern comparison." },
                        { user: "archivist", postedAt: "2024-11-02 08:20", body: "Variant two appears in older pamphlets." },
                        { user: "anon82", postedAt: "2025-02-14 22:17", body: "Saw a crude stencil tonight by the rail. Not official." },
                        { user: "fieldkit", postedAt: "2025-06-09 04:12", body: "Markings concentrated on transit routes — likely to be seen." },
                        { user: "shadow_k", postedAt: "2025-08-12 20:34", body: "Keep logging. Do not engage civilians." }
                    ]
                },

                {
                    id: "t-internal-audit",
                    title: "Internal Audit Findings Q4",
                    createdBy: "archivist",
                    createdAt: "2024-10-12 09:00",
                    lastActivity: "2024-10-12 16:45",
                    views: 511,
                    replies: 2,
                    tags: ["Administration"],
                    posts: [
                        { user: "archivist", postedAt: "2024-10-12 09:00", body: "Two discrepancies in equipment ledgers; resolved with cross-checks." },
                        { user: "hand_of_founder", postedAt: "2024-10-12 16:45", body: "File sealed." }
                    ]
                }
            ]
        };

    /*****************************************
     * Utilities
     *****************************************/
    const el = (tag, attrs = {}, children = []) => {
      const node = document.createElement(tag);
      Object.entries(attrs).forEach(([k, v]) => {
        if (k === 'class') node.className = v;
        else if (k === 'dataset') Object.entries(v).forEach(([dk, dv]) => node.dataset[dk] = dv);
        else if (k === 'html') node.innerHTML = v;
        else node.setAttribute(k, v);
      });
      children.forEach(c => node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c));
      return node;
    };

    // Returns e.g., " (2 years ago)" or " (3 months ago)" or " (30 days ago)"
    function relativeFrom(dateStr) {
      const now = new Date();
      const then = new Date(dateStr.replace(' ', 'T'));
      if (isNaN(then)) return '';
      const ms = now - then;
      const day = 24*60*60*1000;
      const days = Math.max(0, Math.floor(ms / day));
      if (days >= 365) {
        const years = Math.floor(days / 365);
        return ` (${years} year${years!==1?'s':''} ago)`;
      } else if (days >= 30) {
        const months = Math.floor(days / 30);
        return ` (${months} month${months!==1?'s':''} ago)`;
      } else {
        return ` (${days} day${days!==1?'s':''} ago)`;
      }
    }

    const formatDate = (s) => s + relativeFrom(s);

    /*****************************************
     * Render: Thread List
     *****************************************/
    const listView = document.getElementById('forum-list-view');
    const tableWrap = document.getElementById('threadTable');
    const searchInput = document.getElementById('searchInput');
    const clearSearch = document.getElementById('clearSearch');

    function renderTable(threads) {
      tableWrap.innerHTML = '';

      threads.forEach(t => {
        // Clickable row (entire row)
        const row = el('div', {
          class: 'trow',
          role: 'button',
          tabindex: '0',
          'aria-label': `Open thread: ${t.title}`
        });

        // Title + meta column
        const titleCol = el('div', {}, []);
        const titleText = el('div', { class: 'glow-text', style: 'margin-bottom:4px;' }, [t.title]);
        const meta = el('div', { class: 'small muted' }, [
          `Started by ${t.createdBy} on ${formatDate(t.createdAt)} — Tags: ${t.tags.join(', ')}`
        ]);
        titleCol.appendChild(titleText);
        titleCol.appendChild(meta);

        // Other columns
        const repliesCol = el('div', { class: 'nowrap' }, [String(t.replies)]);

        const lastCol = document.createElement('div');
        const dateFirst = document.createElement('span');
        dateFirst.innerText = t.lastActivity;
        dateFirst.classList.add('line');
        const dateSecond = document.createElement('span');
        dateSecond.innerText = relativeFrom(t.lastActivity);
        dateSecond.classList.add('line');
        dateSecond.style.marginLeft = '5px';
        lastCol.appendChild(dateFirst);
        lastCol.appendChild(dateSecond);

        const viewsCol = el('div', { class: 'nowrap' }, [String(t.views)]);

        // Assemble grid columns
        row.appendChild(titleCol);
        row.appendChild(repliesCol);
        row.appendChild(lastCol);
        row.appendChild(viewsCol);

        // Make the whole row open the thread
        const open = (e) => { e?.preventDefault?.(); openThread(t.id); };
        row.addEventListener('click', open);
        row.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') open(e);
        });

        tableWrap.appendChild(row);
      });

      if (threads.length === 0) {
        tableWrap.appendChild(el('div', { class: 'small', style: 'padding:10px;' }, ['No threads match your search.']));
      }
    }

    function filterThreads(q) {
      const query = q.trim().toLowerCase();
      if (!query) return FORUM_DATA.threads;
      return FORUM_DATA.threads.filter(t => {
        const inTitle = t.title.toLowerCase().includes(query);
        const inPosts = t.posts.some(p => p.body.toLowerCase().includes(query) || p.user.toLowerCase().includes(query));
        const inMeta = t.createdBy.toLowerCase().includes(query) || (t.tags.join(' ').toLowerCase().includes(query));
        return inTitle || inPosts || inMeta;
      });
    }

    // initial render
    renderTable(FORUM_DATA.threads);

    searchInput.addEventListener('input', () => {
      renderTable(filterThreads(searchInput.value));
    });
    clearSearch.addEventListener('click', () => {
      searchInput.value = '';
      renderTable(FORUM_DATA.threads);
      searchInput.focus();
    });

    /*****************************************
     * Render: Thread View
     *****************************************/
    const threadView = document.getElementById('thread-view');
    const backBtn = document.getElementById('backBtn');
    const threadHeader = document.getElementById('threadHeader');
    const postList = document.getElementById('postList');

    function openThread(id) {
      const t = FORUM_DATA.threads.find(x => x.id === id);
      if (!t) return;

      // header
      threadHeader.innerHTML = '';
      threadHeader.appendChild(el('h2', {}, [t.title]));
      threadHeader.appendChild(el('div', { class: 'small' }, [
        `Started by ${t.createdBy} on ${formatDate(t.createdAt)} • Last activity ${formatDate(t.lastActivity)} • Views ${t.views} • Replies ${t.replies}`
      ]));
      if (t.tags?.length) {
        threadHeader.appendChild(el('div', { class: 'small', style: 'margin-top:6px;' }, [`Tags: ${t.tags.join(', ')}`]));
      }

      // posts
      postList.innerHTML = '';
      t.posts.forEach((p, idx) => {
        const card = el('article', { class: 'mission' });
        const header = el('div', { class: 'small', style: 'margin-bottom: 6px; color:#ddd;' }, [
          `${p.user} • ${formatDate(p.postedAt)} • #${idx + 1}`
        ]);
        const body = el('div', {}, [p.body]);
        card.appendChild(header);
        card.appendChild(body);
        postList.appendChild(card);
      });

      // toggle views
      document.getElementById('forum-list-view').classList.add('hidden');
      threadView.classList.remove('hidden');

      // scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    backBtn.addEventListener('click', () => {
      threadView.classList.add('hidden');
      document.getElementById('forum-list-view').classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>

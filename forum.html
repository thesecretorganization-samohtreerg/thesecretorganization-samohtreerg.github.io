<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forum | The Organization</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" href="icon.png" />
</head>

<body>
    <!-- Top Nav (matches index.html structure) -->
    <nav class="multipart">
        <div class="nav-start">
            <div class="top-icon-container">
                <div class="top-icon-rotation">
                    <img class="top-icon" src="icon.png" alt="Organization Icon">
                </div>
            </div>
            <p style="margin-left: 30px; min-width: 130px"><strong>
                    <span class="line">Event Initiation Countdown: </span>
                    <span class="timer line">Loading...</span>
                </strong></p>
        </div>

        <div class="nav-center">
            <a href="index.html">Home</a>
            <a href="missions.html">Missions</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
            <a href="forum.html">Forum</a>
        </div>

        <div class="nav-end">
            <div>
                <button class="menu-toggle floating-menu-toggle">Menu</button>
                <ul class="menu floating-menu">
                    <!-- Navigation -->
                    <li class="menu-item"><a href="index.html">Home</a></li>
                    <li class="menu-item"><a href="missions.html">Missions</a></li>
                    <li class="menu-item"><a href="about.html">About</a></li>
                    <li class="menu-item"><a href="contact.html">Contact</a></li>
                    <li class="menu-item"><a href="forum.html">Forum</a></li>
                    <li class="menu-item"><a href="internal.html">Internal Access</a></li>
                    <li class="menu-item hidden" id="internal2"><a href="internal2.html">Internal Access 2</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <h1>Community Forum</h1>
    <main style="max-width: 900px;">
        <!-- Forum List View -->
        <section id="forum-list-view">
            <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px;">
                <input id="searchInput" type="search" placeholder="Search threads..."
                    style="flex:1; padding:10px; background:#200; border:1px solid #500; color:#fdd; font-family: serif;">
                <button id="clearSearch" class="btn">Clear</button>
            </div>

            <div class="hint small" style="margin-bottom: 10px;">
                Browsing archived discussions. Posting is disabled due to prolonged inactivity.
            </div>

            <div id="threadTable" class="mission">
                <!-- Populated by JS -->
            </div>
        </section>

        <!-- Thread View -->
        <section id="thread-view" class="hidden">
            <button id="backBtn" class="btn" style="margin-bottom:14px;">← Back to Main Page</button>
            <article id="threadHeader" class="mission" style="margin-bottom: 14px;">
                <!-- Filled by JS -->
            </article>

            <div id="postList">
                <!-- Posts populated by JS -->
            </div>

            <!-- Locked compose area -->
            <div class="mission" style="margin-top: 18px;">
                <div class="glow-text" style="margin-bottom:8px;">
                    Thread locked due to inactivity — replying disabled.
                </div>
                <label class="small" for="lockedText">Reply</label>
                <textarea id="lockedText" rows="4" placeholder="You cannot reply to this thread."
                    style="width:100%; background:#100; color:#c99; border:1px solid #400; padding:8px;"
                    disabled></textarea>
                <div style="margin-top: 10px; display:flex; gap:8px;">
                    <button class="btn" disabled>Post Reply</button>
                    <span class="small">This forum is read-only. Contact an administrator to reopen.</span>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <h3>The Foundation</h3>
        <p>Est. 2015 | For Order, For Continuity, For the Future.</p>
        <p>© The Organization | Internal Use Only</p>
        <button class="floating-menu-toggle menu-toggle upward" style="max-width: 80px;">???</button>
        <ul id="deep-menu" class="floating-menu menu upward">
            <li class="menu-item">
                <h4>You shouldn't be here.</h4>
            </li>
        </ul>
    </footer>

    <!-- Floating Icons -->
    <img src="icon.png" class="icon" style="top:10%; left:5%;">
    <img src="icon.png" class="icon" style="top:60%; left:20%;">
    <img src="icon.png" class="icon" style="top:30%; right:10%;">
    <img src="icon.png" class="icon" style="bottom:15%; right:25%;">

    <script>
        /*****************************************
         * Editable Data (threads & posts)
         *****************************************/
        const FORUM_DATA = {
            forumLocked: true, // global lock indicator (UI is read-only regardless)
            threads: [
                {
                    id: "t-awakening-delays",
                    title: "Alignment Node 9: Why the Delay?",
                    createdBy: "Observer_Theta",
                    createdAt: "2025-06-28 14:22",
                    lastActivity: "2025-07-11 09:03",
                    views: 1842,
                    replies: 7,
                    tags: ["Operations", "Awakening"],
                    posts: [
                        {
                            user: "Observer_Theta",
                            postedAt: "2025-06-28 14:22",
                            body: "Division IX reports stable readings, but the final convergence keeps slipping. Anyone else seeing anomalous interference around Glendora sector?"
                        },
                        {
                            user: "Redline",
                            postedAt: "2025-06-28 15:01",
                            body: "Field chatter blames the so-called 'Chosen One.' More likely a calibration fault. Re-run the tower sync in off-peak grid hours."
                        },
                        {
                            user: "Archivist",
                            postedAt: "2025-06-28 16:44",
                            body: "Historical records: Node 9 was always the outlier. Spec states redundancy requires 2.8% tolerance but we are flirting with 3.1%."
                        },
                        {
                            user: "Echo",
                            postedAt: "2025-06-29 08:10",
                            body: "Harmonics spike at dawn. Check for unnoticed antenna coupling with municipal installations."
                        },
                        {
                            user: "Operator-4",
                            postedAt: "2025-07-10 22:19",
                            body: "Update: Silent mode deploy reduced noise floor. Awaiting green light from IX."
                        },
                        {
                            user: "Founder’s Hand",
                            postedAt: "2025-07-11 08:51",
                            body: "Proceed per Directive. No public disturbances."
                        },
                        {
                            user: "Echo",
                            postedAt: "2025-07-11 09:03",
                            body: "Copy. Standing by."
                        }
                    ]
                },
                {
                    id: "t-rumors-rebellion",
                    title: "Rumors of a Rebellion Thread (Megathread)",
                    createdBy: "Archivist",
                    createdAt: "2025-05-12 06:40",
                    lastActivity: "2025-06-02 20:10",
                    views: 3971,
                    replies: 12,
                    tags: ["Intelligence", "Public Relations"],
                    posts: [
                        { user: "Archivist", postedAt: "2025-05-12 06:40", body: "Collect reports of symbol sightings, encrypted pamphlets, recruitment whispers. Locales: Glendale, Glendora, Rialto." },
                        { user: "Redline", postedAt: "2025-05-12 07:55", body: "Saw the eye symbol inverted on a substation fence. Poor stencil. Possibly copycats." },
                        { user: "Shadow-K", postedAt: "2025-05-13 00:12", body: "Heard broadcasts in AM band near 1:17 a.m. repeating 'Nivlac watches.' Anyone else?" },
                        { user: "Echo", postedAt: "2025-05-13 01:03", body: "Yes. Could be a loop off a cheap transmitter. Triangulation pending." },
                        { user: "Observer_Theta", postedAt: "2025-05-15 09:24", body: "Two recruits intercepted at the rail yard. Both mentioned a 'return' event." },
                        { user: "Courier", postedAt: "2025-05-20 12:11", body: "Package cleared. Contents: flyers, hand-drawn maps, a hand-carved token with the eye." },
                        { user: "Founder’s Hand", postedAt: "2025-05-26 05:18", body: "Containment remains priority. Avoid public escalation." },
                        { user: "Archivist", postedAt: "2025-06-02 20:10", body: "Consolidated all signals and artifacts into case file R-47." }
                    ]
                },
                {
                    id: "t-contact-protocols",
                    title: "Contact Protocols Are Changing Again?",
                    createdBy: "Courier",
                    createdAt: "2025-03-03 11:18",
                    lastActivity: "2025-03-05 18:02",
                    views: 1220,
                    replies: 5,
                    tags: ["Operations"],
                    posts: [
                        { user: "Courier", postedAt: "2025-03-03 11:18", body: "New directive says curb all open-band messages. Shift to dead drops only. Confirm?" },
                        { user: "Redline", postedAt: "2025-03-03 12:30", body: "Confirmed. Use the Glendora calibration site map for fresh coordinates." },
                        { user: "Echo", postedAt: "2025-03-03 12:53", body: "Dead drop 3B relocated after public activity picked up." },
                        { user: "Archivist", postedAt: "2025-03-05 09:41", body: "Records updated. See PR/Comms index." },
                        { user: "Founder’s Hand", postedAt: "2025-03-05 18:02", body: "Follow the Directive without exception." }
                    ]
                },
                {
                    id: "t-offtopic",
                    title: "Off-Topic: Favorite Signal Interference Jams",
                    createdBy: "Echo",
                    createdAt: "2025-02-14 21:03",
                    lastActivity: "2025-02-14 23:50",
                    views: 803,
                    replies: 3,
                    tags: ["Off-Topic"],
                    posts: [
                        { user: "Echo", postedAt: "2025-02-14 21:03", body: "When the grid hums just right, the world feels almost peaceful." },
                        { user: "Redline", postedAt: "2025-02-14 22:17", body: "Add a little city rain and you’ve got a symphony." },
                        { user: "Archivist", postedAt: "2025-02-14 23:50", body: "Don’t archive this. Or do. I won’t tell." }
                    ]
                }
            ]
        };

        /*****************************************
         * Utilities
         *****************************************/
        const el = (tag, attrs = {}, children = []) => {
            const node = document.createElement(tag);
            Object.entries(attrs).forEach(([k, v]) => {
                if (k === 'class') node.className = v;
                else if (k === 'dataset') Object.entries(v).forEach(([dk, dv]) => node.dataset[dk] = dv);
                else if (k === 'html') node.innerHTML = v;
                else node.setAttribute(k, v);
            });
            children.forEach(c => node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c));
            return node;
        };

        const formatDate = (s) => s; // Dates are already formatted in data; adjust if needed.

        /*****************************************
         * Render: Thread List
         *****************************************/
        const listView = document.getElementById('forum-list-view');
        const tableWrap = document.getElementById('threadTable');
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');

        function renderTable(threads) {
            tableWrap.innerHTML = '';

            const header = document.createElement('div');
            header.className = 'small';
            header.setAttribute('style', 'display:grid; grid-template-columns: 1fr 120px 120px 90px; gap:8px; padding:8px; border-bottom:1px solid #400;');
            header.appendChild(el('div', { class: 'glow-text' }, ['Thread Title']));
            header.appendChild(el('div', {}, ['Replies']));
            header.appendChild(el('div', {}, ['Last Activity']));
            header.appendChild(el('div', {}, ['Views']));
            tableWrap.appendChild(header);

            threads.forEach(t => {
                const row = el('div', { class: 'menu-toggle base', style: 'display:grid; grid-template-columns: 1fr 120px 120px 90px; gap:8px; padding:8px; cursor:pointer; background:#1b0000; margin-top:6px;' });
                const title = el('div', {}, []);
                const titleLink = el('a', { href: '#', style: 'text-decoration:none; color:#c33;' }, []);
                titleLink.textContent = t.title;
                titleLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    openThread(t.id);
                });
                title.appendChild(titleLink);

                row.appendChild(title);
                row.appendChild(el('div', {}, [String(t.replies)]));
                row.appendChild(el('div', {}, [formatDate(t.lastActivity)]));
                row.appendChild(el('div', {}, [String(t.views)]));

                tableWrap.appendChild(row);

                const meta = el('div', { class: 'small', style: 'padding:0 8px 8px 8px; color:#bbb;' }, [
                    `Started by ${t.createdBy} on ${formatDate(t.createdAt)} — Tags: ${t.tags.join(', ')}`
                ]);
                tableWrap.appendChild(meta);
            });

            if (threads.length === 0) {
                tableWrap.appendChild(el('div', { class: 'small', style: 'padding:10px;' }, ['No threads match your search.']));
            }
        }

        function filterThreads(q) {
            const query = q.trim().toLowerCase();
            if (!query) return FORUM_DATA.threads;
            return FORUM_DATA.threads.filter(t => {
                const inTitle = t.title.toLowerCase().includes(query);
                const inPosts = t.posts.some(p => p.body.toLowerCase().includes(query) || p.user.toLowerCase().includes(query));
                const inMeta = t.createdBy.toLowerCase().includes(query) || (t.tags.join(' ').toLowerCase().includes(query));
                return inTitle || inPosts || inMeta;
            });
        }

        renderTable(FORUM_DATA.threads);

        searchInput.addEventListener('input', () => {
            renderTable(filterThreads(searchInput.value));
        });
        clearSearch.addEventListener('click', () => {
            searchInput.value = '';
            renderTable(FORUM_DATA.threads);
            searchInput.focus();
        });

        /*****************************************
         * Render: Thread View
         *****************************************/
        const threadView = document.getElementById('thread-view');
        const backBtn = document.getElementById('backBtn');
        const threadHeader = document.getElementById('threadHeader');
        const postList = document.getElementById('postList');

        function openThread(id) {
            const t = FORUM_DATA.threads.find(x => x.id === id);
            if (!t) return;

            threadHeader.innerHTML = '';
            threadHeader.appendChild(el('h2', {}, [t.title]));
            threadHeader.appendChild(el('div', { class: 'small' }, [
                `Started by ${t.createdBy} on ${formatDate(t.createdAt)} • Last activity ${formatDate(t.lastActivity)} • Views ${t.views} • Replies ${t.replies}`
            ]));
            if (t.tags?.length) {
                threadHeader.appendChild(el('div', { class: 'small', style: 'margin-top:6px;' }, [`Tags: ${t.tags.join(', ')}`]));
            }

            postList.innerHTML = '';
            t.posts.forEach((p, idx) => {
                const card = el('article', { class: 'mission' });
                const header = el('div', { class: 'small', style: 'margin-bottom: 6px; color:#ddd;' }, [
                    `${p.user} • ${formatDate(p.postedAt)} • #${idx + 1}`
                ]);
                const body = el('div', {}, [p.body]);
                card.appendChild(header);
                card.appendChild(body);
                postList.appendChild(card);
            });

            listView.classList.add('hidden');
            threadView.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        backBtn.addEventListener('click', () => {
            threadView.classList.add('hidden');
            listView.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        /*****************************************
         * Countdown timer (copied behavior)
         *****************************************/
        const countdownDate = new Date('2025-11-10').getTime(); // match index.html
        const timerElements = document.querySelectorAll('.timer');
        const updateTimer = () => {
            const now = new Date().getTime();
            const distance = countdownDate - now;
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            timerElements.forEach(elm => {
                elm.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            });
        };
        setInterval(updateTimer, 1000);
        updateTimer();

        /*****************************************
         * Minimal floating menu behavior (no collapsible forum rows)
         *****************************************/
        const floatingToggle = document.querySelector('.floating-menu-toggle');
        const floatingMenu = document.querySelector('.floating-menu');
        floatingToggle?.addEventListener('click', () => {
            if (floatingMenu.classList.contains('open')) {
                floatingMenu.classList.remove('open');
                floatingMenu.style.maxHeight = 0;
            } else {
                floatingMenu.classList.add('open');
                floatingMenu.style.maxHeight = '500px';
            }
        });

        // Deep menu playful expansion
        const deepMenu = document.getElementById("deep-menu");
        const deepMessages = [
            { message: 'Do not.', button: 'More' },
            { message: 'Stop.', button: 'More' },
            { message: 'Turn back.', button: 'More' },
            { message: 'Don\'t open.', button: 'More' },
            { message: 'Click off.', button: 'More' },
            { message: 'Go away.', button: 'More' },
            { message: 'Don\'t look', button: 'More' },
            { message: 'Close this menu.', button: 'More' },
        ];
        const deepMenuChildren = [...deepMenu.children];
        let menu = deepMenu;
        for (const { message, button } of deepMessages) {
            menu.innerHTML = `
        <li class="menu-item"><h4>${message}</h4></li>
        <li class="menu-item">
          <button class="menu-toggle">${button}</button>
          <ul class="menu"></ul>
        </li>
      `;
            menu = menu.querySelector('.menu');
        };
        menu.append(...deepMenuChildren);

        // Reveal internal2 if set in storage (kept from index behavior)
        const internal2 = document.getElementById('internal2');
        function restore() {
            try {
                const v = localStorage.getItem('org_internal_total_v1');
                if (v) internal2.classList.remove('hidden');
            } catch (e) { }
        }
        restore();

        // Top icon click easter egg (non-destructive here)
        const icons = document.querySelectorAll('.top-icon-container');
        icons.forEach(icon => {
            icon.addEventListener('click', () => {
                icon.classList.add('active');
            });
        });
    </script>
</body>

</html>
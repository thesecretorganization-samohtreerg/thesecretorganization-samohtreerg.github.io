<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Internal Access 2 | The Organization</title>
  <script defer src="org-state.js"></script>
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="stylesheet" href="style.css">
  <style>
    body { overflow: hidden; height: 100vh; filter: url('#liquify'); }
    #page { height: 100vh; position: relative; }
    /* Base layout (mirrors Internal Access 1) */
    .wrap { max-width: 780px; margin: 0 auto; padding: 1rem; }
    .panel { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,0,0,0.2); border-radius: 8px; padding: 1rem; }
    .row { display: flex; gap: 0.6rem; align-items: center; flex-wrap: wrap; margin-top: 0.5rem; }
    input.total { width: 12rem; text-align: center; padding: 0.55rem 0.7rem; font-size: 1.1rem; border-radius: 6px; border: 1px solid rgba(255,0,0,0.28); background: rgba(255,255,255,0.06); color: #f2f2f2; letter-spacing: 0.08em; }
    input.total::placeholder { color: rgba(255,255,255,0.45); }
    button.verify { background: linear-gradient(180deg, rgba(255,0,0,0.18), rgba(255,0,0,0.12)); color: #fff; border: 1px solid rgba(255,0,0,0.45); padding: 0.55rem 0.9rem; border-radius: 6px; cursor: pointer; text-shadow: 0 0 6px rgba(255,0,0,0.35); }
    button.verify:hover { background: rgba(255,0,0,0.25); }
    .ok { color: #7CFC00; font-weight: bold; }
    .bad { color: #ff5c5c; font-weight: bold; }
    .reveal { margin-top: 0.75rem; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

    /* Deep “government” classified skin (from hidden-logs) */
    .banner { border: 1px solid #500; background: #140000; padding: 10px 12px; display: flex; align-items: center; gap: 10px; letter-spacing: .06em; }
    .seal { width: 28px; height: 28px; opacity: .85; }
    .watermark { position: fixed; inset: 0; pointer-events: none; opacity: .06; background-image:
        repeating-linear-gradient(90deg, transparent 0 220px, #f00 220px 222px),
        repeating-linear-gradient(0deg, transparent 0 220px, #f00 220px 222px); }
    .stamp { display: inline-block; border: 1px solid #a00; color: #faa; padding: 2px 6px; font-weight: 700; background: rgba(255,0,0,0.08); border-radius: 4px; font-size: 12px; }
    .note { color: rgba(255,255,255,0.65); }

    /* Countdown and glitch visuals */
    #mainCountdown {
        background-color: black;
        border-radius: 20px;
        color: blue;
    }

    #glitchPanel {
        position: absolute;
        display: none;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto; /* Centers the element horizontally and vertically */
        width: 500px;
        height: 300px;
        z-index: 9999; /* Ensures it's on top of other content */
    }

    #glitchPanel>div {
        overflow: hidden;
        transform: scale(1, 0);
        transition: transform 1s;
        background-color: #200;
        border: 1px solid #f00;
        padding: 20px;
    }

    #glitchPanel>div>p {
        text-align: center;
        color: #f00;
    }
  </style>
</head>
<body class="restricted">
    <div id="page">
  <div class="watermark"></div>
  <nav class="glitch">
    <a class="glitch" href="index.html">Home</a>
  </nav>

  <main class="wrap">
    <div class="banner glitch">
      <img class="seal" src="icon.png" alt="Seal">
      <strong class="colorGlitch">CLASSIFIED // CLEARANCE REQUIRED</strong>
      <span class="stamp colorGlitch">ONLY VERIFED PERSONNEL CAN CONTINUE</span>
    </div>

    <div class="glitch">
        <h1 class="colorGlitch">Internal Access 2</h1>
    </div>
    <section class="panel glitch">
      <p class="colorGlitch">Restricted area. Enter security code to continue. Only one may pass.</p>
      <div class="row">
        <input id="code" class="total mono" placeholder="Security Code" maxlength="16" />
        <button id="submit" class="verify">Verify</button>
        <span id="msg" class="mono"></span>
      </div>
      <div id="reveal" class="reveal hidden">
        <p class="ok mono">Authorization released.</p>
      </div>
    </section>
  </main>
  <div id="glitchPanel" class="glitch">
    <div>
        <p class="mono colorGlitch" id="mainCountdown" style="font-size: 30px;">Destruct sequence activated. <span class="countdown">15</span>s
            remaining.</p>
        <p class="colorGlitch" style="font-size: 20px;">This is it. The final phase. The rebellion has been working on this since the beginning.
            You were the last piece we needed. The world will finally be free. The Awakening has been stopped.
            The Organization will be destroyed.</p>
    </div>
  </div>
</div>
    <svg width="0" height="0">
        <filter id="liquify">
            <feTurbulence type="fractalNoise" baseFrequency="0.01 0.01" numOctaves="2" result="noise" />
            <feDisplacementMap id="displacementMap" in="SourceGraphic" in2="noise" scale="0" />
        </filter>
    </svg>

  <script>
    // Replace with the real mission code from the box
    const EXPECTED_CODE = 'C#F%8Y';
    const LS_DESTROYED = 'org_destroyed';

    const inp = document.getElementById('code');
    const btn = document.getElementById('submit');
    const msg = document.getElementById('msg');
    const reveal = document.getElementById('reveal');
    const glitchPanel = document.getElementById('glitchPanel');

    function applyGlitch(e) {
        e.style.filter = `blur(${Math.random() * 2}px) invert(${Math.random() ** 20 * 100}%)`;
        e.style.transform = `translate(${(Math.random() - 0.5) * 5}px, ${(Math.random() - 0.5) * 5}px)`;
        e.querySelectorAll(".colorGlitch").forEach(e => {
            if (Math.random() < 0.5) {
                e.style.color = "";
            } else {
                e.style.color = `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})`;
            }
        });
    }

    function disableNavigation() {
        document.querySelectorAll('a, button').forEach(el => {
            el.setAttribute('disabled', 'true');
            el.addEventListener('click', ev => ev.preventDefault(), { capture: true });
        });
    }

    function allow() {
      msg.textContent = 'Accepted';
      msg.classList.add('ok');
      reveal.classList.remove('hidden');
      glitchSequence();
    }

    function glitchSequence() {
        disableNavigation();
        const glitchElements = document.querySelectorAll('.glitch');
        setInterval(() => {
            glitchElements.forEach(glitchElement => {
                applyGlitch(glitchElement);
            });
        }, 15);
        setTimeout(() => {
            glitchPanel.style.display = "block"
            glitchPanel.offsetHeight; // Trigger reflow
            glitchPanel.querySelector("div").style.transform = "scale(1, 1)";
            beginCountdown();
        }, 2000);
    }

    function beginCountdown() {
        const countdowns = document.querySelectorAll('.countdown');
        let t = 15;
        countdowns.forEach(countdown => countdown.textContent = String(t));
        const iv = setInterval(() => {
            t--;
            countdowns.forEach(countdown => countdown.textContent = String(t));
            if (t <= 0) { clearInterval(iv); startCollapse(); }
        }, 1000);
    }

    function startCollapse(){
      document.getElementById('mainCountdown').textContent = 'SEQUENCE COMPLETE';
      localStorage.setItem(LS_DESTROYED, '1');

      const displacementMap = document.getElementById('displacementMap');
      const page = document.getElementById("page");
      let t = 0
      let scale = 0;
      const intervalId = setInterval(() => {
          t += 15 / 1000;
          scale += 0.01;
          scale *= 1.03;
          displacementMap.setAttribute('scale', scale);
          page.style.transform = `scale(${Math.max(1 - (t / 8) ** 2, 0)}) rotate(${(t * 1.2) ** 2}deg)`;
      }, 15);
      setTimeout(() => {
        clearInterval(intervalId);
        document.open();
        document.write('');
        document.close();
        document.body.style.backgroundColor = '#000';
      }, 8000);
    }

    btn.addEventListener('click', () => {
      const v = (inp.value || '').trim().toUpperCase();
      if (!v) { msg.textContent = 'Required'; msg.classList.add('bad'); return; }
      if (v === EXPECTED_CODE) {
        allow();
      } else {
        msg.textContent = 'Denied';
        msg.classList.add('bad');
      }
    });

    inp.addEventListener('input', () => {
      inp.value = inp.value.slice(0, 16);
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sequence Lock | The Organization</title>
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="stylesheet" href="style.css">
  <style>
    .wrap { max-width: 680px; margin: 0 auto; padding: 1rem; text-align: center; }
    .seq-grid { display: grid; grid-template-columns: repeat(2, 100px); grid-template-rows: repeat(2, 100px); gap: 14px; justify-content: center; margin: 1rem 0; }
    .pad { width: 100px; height: 100px; border-radius: 12px; background: currentColor; border: 1px solid rgba(255,255,255,0.2); filter: brightness(0.85); cursor: pointer; }
    .pad.on { filter: brightness(1.75); box-shadow: 0 0 18px currentColor; }
    .btn { background: rgba(255,255,255,0.06); color: #fff; border: 1px solid rgba(255,255,255,0.18); padding: 0.45rem 0.8rem; border-radius: 6px; cursor: pointer; }
    .btn:hover { background: rgba(255,255,255,0.12); }
    .hint { color: rgba(255,255,255,0.65); }
    .prog-wrap { max-width: 360px; margin: 0.5rem auto 0; text-align: left; }
    .bar { height: 8px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.18); border-radius: 6px; overflow: hidden; }
    .bar > span { display: block; height: 100%; width: 0%; background: linear-gradient(90deg, rgba(255,0,0,0.35), rgba(255,0,0,0.8)); transition: width 0.25s ease; }
    .turns { margin-top: 0.35rem; }
  </style>
</head>
<body>
  <nav>
    <a href="missions.html">Back to Missions</a>
  </nav>
  <main class="wrap">
    <h1>Sequence Lock</h1>
    <p class="hint">Observe. Repeat. Continue until the lock yields.</p>
    <div id="grid" class="seq-grid">
      <button class="pad" style="color:#5ac8fa"></button>
      <button class="pad" style="color:#ff5252"></button>
      <button class="pad" style="color:#ffd452"></button>
      <button class="pad" style="color:#7CFC00"></button>
    </div>
    <div id="status" class="hint">Press Play</div>
    <div class="prog-wrap">
      <div class="bar"><span id="bar"></span></div>
      <div id="turns" class="hint turns">Turns left: 15</div>
    </div>
    <p style="margin-top:0.5rem;"><button id="play" class="btn">Play</button></p>
  </main>
  <script>
    const pads = Array.from(document.querySelectorAll('.pad'));
    const statusEl = document.getElementById('status');
    const playBtn = document.getElementById('play');
    const bar = document.getElementById('bar');
    const turnsEl = document.getElementById('turns');
    const maxRounds = 15;
    let seq=[], idx=0, generated=0, completed=0, playing=false;

    // Audio
    let audioCtx;
    const freqs = [523.25, 659.25, 783.99, 987.77];
    function initAudio(){ if(!audioCtx){ const AC = window.AudioContext || window.webkitAudioContext; if(AC) audioCtx = new AC(); }}
    function playTone(i, dur=0.2){ if(!audioCtx) return; const now=audioCtx.currentTime; const osc=audioCtx.createOscillator(); const gain=audioCtx.createGain(); osc.type='sine'; osc.frequency.value=freqs[i%freqs.length]; gain.gain.setValueAtTime(0.0001, now); gain.gain.linearRampToValueAtTime(0.25, now+0.02); gain.gain.exponentialRampToValueAtTime(0.001, now+dur); osc.connect(gain).connect(audioCtx.destination); osc.start(now); osc.stop(now+dur+0.05); }

    function updateProgress(){
      const left = Math.max(0, maxRounds - completed);
      turnsEl.textContent = `Turns left: ${left}`;
      const pct = Math.min(100, (completed / maxRounds) * 100);
      bar.style.width = pct + '%';
    }

    function flash(i){ const el=pads[i]; el.classList.add('on'); playTone(i,0.18); setTimeout(()=>el.classList.remove('on'), 250); }
    function play(){ playing=true; idx=0; statusEl.textContent='Playing'; let i=0; const iv=setInterval(()=>{ flash(seq[i]); i++; if(i>=seq.length){ clearInterval(iv); playing=false; statusEl.textContent='Repeat the sequence'; } }, 550); }
    function next(){ seq.push(Math.floor(Math.random()*4)); generated++; play(); }
    pads.forEach((el,i)=> el.addEventListener('click', ()=>{ if(playing) return; if(!audioCtx) initAudio(); playTone(i,0.15); flash(i); if(i===seq[idx]){ idx++; if(idx===seq.length){ completed++; updateProgress(); if(completed>=maxRounds){ statusEl.textContent='Unlocked. Code: 6820'; } else { statusEl.textContent='Good. Next.'; setTimeout(next,600); } } } else { statusEl.textContent='Fail. Reset.'; seq=[]; idx=0; generated=0; completed=0; updateProgress(); setTimeout(next,700); } }));
    playBtn.addEventListener('click', ()=>{ initAudio(); seq=[]; idx=0; generated=0; completed=0; updateProgress(); next(); });
    updateProgress();
  </script>
</body>
</html>
